<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Empty-String Calendar</title>

    <!-- Default stylesheet -->
    <link href="style.css" rel="stylesheet">
</head>

<body>
    <div>
        <label for="startDate">Start Date:</label>
        <input id="startDate" type="text" placeholder="MM/DD/YYYY" />
        <label for="endDate">End Date:</label>
        <input id="endDate" type="text" placeholder="MM/DD/YYYY" />
    </div>

    <button id="send">Enter</button>
    <div id="errorMessage"></div>

    <div>
        <h3 id="tableHeader" style="text-align: center"></h3>
        <table id="table">
            <tbody id="calendar"></tbody>
        </table>
    </div>

    <script>
        let button = document.getElementById("send");
        let errorMessage = document.getElementById("errorMessage");
        let convertMonth = {
            1: "January", 2: "February", 3: "March", 4: "April", 5: "May", 6: "June", 7: "July", 8: "August",
            9: "September", 10: "October", 11: "November", 12: "December"
        }
        let convertDayOfTheWeek = { 0: "Sunday", 1: "Monday", 2: "Tuesday", 3: "Wednesday", 4: "Thursday", 5: "Friday", 6: "Saturday" }
        let daysInMonth = { 1: 31, 2: 28, 3: 31, 4: 30, 5: 31, 6: 30, 7: 31, 8: 31, 9: 30, 10: 31, 11: 30, 12: 31 }

        button.addEventListener("click", () => {
            let startDateInput = document.getElementById("startDate").value;
            let endDateInput = document.getElementById("endDate").value;
            if (startDateInput[2] != "/") {
                startDateInput = "0" + startDateInput
            }
            if (startDateInput[5] != "/") {
                startDateInput = startDateInput.substring(0, 3) + "0" + startDateInput.substring(3)
            }
            if (endDateInput[2] != "/") {
                endDateInput = "0" + endDateInput
            }
            if (endDateInput[5] != "/") {
                endDateInput = endDateInput.substring(0, 3) + "0" + endDateInput.substring(3)
            }
            errorMessage.textContent = ""
            let url = `/calendar?start=${startDateInput}&end=${endDateInput}`

            fetch(url).then((response) => {
                return response.json();
            }).then((body) => {
                if (body.error) {
                    errorMessage.textContent = body.error;
                }
                else {
                    let month = convertMonth[body.start.month]
                    let totalDays = daysInMonth[body.start.month]
                    let leapYear = body.leapYear
                    //february on a leap year has an extra day
                    if (leapYear && month === 2) {
                        totalDays += 1
                    }
                    let extraWeek = false;
                    document.getElementById("tableHeader").textContent = month + " " + body.year;
                    let calendar = document.getElementById("calendar");
                    let table = document.getElementById("table");

                    let toDelete = document.getElementsByClassName("deleteWeek")
                    while (toDelete[0]) {
                        toDelete[0].parentNode.removeChild(toDelete[0])
                    }

                    table.style.width = "1050px";
                    table.style.height = "500px";
                    table.style.marginLeft = "auto";
                    table.style.marginRight = "auto";
                    table.style.border = "2px solid black";
                    table.style.borderCollapse = "collapse";
                    let dayCount = 1
                    for (let i = 0; i < 7; i++) {
                        if (!extraWeek) {
                            let week = document.createElement("tr");
                            week.style.border = "2px solid black"
                            week.style.borderCollapse = "collapse"
                            for (let j = 0; j < 7; j++) {
                                let day;
                                if (i === 1) {
                                    day = document.createElement("td");
                                    if (j >= body.firstWeekDayOfMonth) {
                                        day.textContent = dayCount;
                                        dayCount++;
                                        day.style.textAlign = "left"
                                        day.style.verticalAlign = "top"
                                    }
                                }
                                else if (i > 0) {
                                    day = document.createElement("td");
                                    if (dayCount <= totalDays) {
                                        day.textContent = dayCount;
                                        dayCount++;
                                        day.style.textAlign = "left"
                                        day.style.verticalAlign = "top"
                                    }
                                    else {
                                        extraWeek = true;
                                    }
                                }
                                else {
                                    day = document.createElement("th");
                                    let dayOfTheWeek = convertDayOfTheWeek[j];
                                    day.textContent = dayOfTheWeek;
                                    day.style.height = "30px"
                                }
                                day.style.width = "150px"
                                day.style.border = "2px solid black"
                                day.style.borderCollapse = "collapse"
                                week.appendChild(day)
                            }
                            week.setAttribute("class", "deleteWeek")
                            calendar.appendChild(week)
                        }
                    }
                }
            })
        });

    </script>
</body>

</html>